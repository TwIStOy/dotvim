import { BuildContext } from "@glib/build-context";
import { Widget } from "@glib/widget";
import { mdNode } from "./md-node";
import { MdNodeBase } from "./base";
import { MdNodeFactory } from "./node-factory";

export class MdAtxHeading extends MdNodeBase {
  intoWidget(_context: BuildContext): Widget {
    let body = this.node.child(1);
    let [_startRow, _startColumn, startByte] = this.node.start();
    let firstChildType;
    {
      let child = this.node.child(0);
      let [_childStartRow, _childStartColumn, childStartByte] = child.start();
      assert(childStartByte === startByte);
      startByte += child.byte_length();
      firstChildType = child.type();
    }
    let [level_str] = string.match(firstChildType, "atx_h(%d+)_marker");
    let level = tonumber(level_str)!;
    let pd = [...this.props];
    if (level === 1) {
      pd.push(`font_size="200%"`);
    } else if (level === 2) {
      pd.push(`font_size="150%"`);
    } else if (level === 3) {
      pd.push(`font_size="120%"`);
    }
    return MdNodeFactory.getInstance().create(body, this.source, pd);
  }
}
